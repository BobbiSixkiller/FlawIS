fragment Course on Course {
  id
  name
  categories {
    id
    name
    slug
  }
  start
  end
  registrationEnd
  maxAttendees
  description
  price
  billing {
    ...FlawBilling
  }
  isPaid
  attending {
    ...CourseAttendee
  }
  createdAt
  updatedAt
}

fragment CourseSession on CourseSession {
  id
  course
  name
  description
  start
  end
  maxAttendees
  createdAt
  updatedAt
}

fragment CourseAttendee on CourseAttendee {
  id
  user {
    id
    name
    email
    telephone
    organization
    avatarUrl
  }
  fileUrls
  course
  status
  createdAt
  updatedAt
}

fragment Attendance on Attendance {
  attendee {
    id
    fileUrls
    user {
      name
    }
    status
  }
  attendanceRecords {
    online
    hoursAttended
  }
}

query courses($after: String, $first: Int, $sort: [CourseSortInput]!) {
  courses(after: $after, first: $first, sort: $sort) {
    totalCount
    edges {
      cursor
      node {
        ...Course
      }
    }
    pageInfo {
      hasNextPage
      endCursor
    }
  }
}

query course($id: ObjectId!) {
  course(id: $id) {
    ...Course
  }
}

query attendance(
  $id: ObjectId!
  $after: String
  $first: Int
  $sort: [CourseAttendeeSortInput]!
) {
  course(id: $id) {
    attendance(after: $after, first: $first, sort: $sort) {
      totalCount
      pageInfo {
        hasNextPage
        endCursor
      }
      edges {
        cursor
        node {
          ...Attendance
        }
      }
      sessions {
        ...CourseSession
      }
    }
  }
}

mutation createCourse($data: CourseInput!) {
  createCourse(data: $data) {
    message
    data {
      ...Course
    }
  }
}

mutation deleteCourse($id: ObjectId!) {
  deleteCourse(id: $id) {
    message
    data {
      ...Course
    }
  }
}

mutation updateCourse($id: ObjectId!, $data: CourseInput!) {
  updateCourse(id: $id, data: $data) {
    message
    data {
      ...Course
    }
  }
}

mutation createCourseSession($data: CourseSessionInput!) {
  createCourseSession(data: $data) {
    message
    data {
      ...CourseSession
    }
  }
}

mutation updateCourseSession($id: ObjectId!, $data: CourseSessionInput!) {
  updateCourseSession(id: $id, data: $data) {
    message
    data {
      ...CourseSession
    }
  }
}

mutation deleteCourseSession($id: ObjectId!) {
  deleteCourseSession(id: $id) {
    message
    data {
      ...CourseSession
    }
  }
}

mutation createCourseAttendee(
  $courseId: ObjectId!
  $fileUrls: [String!]!
  $billing: AttendeeBillingInput
) {
  createCourseAttendee(
    courseId: $courseId
    fileUrls: $fileUrls
    billing: $billing
  ) {
    message
    data {
      ...CourseAttendee
    }
  }
}

mutation updateCourseAttendeeFiles($id: ObjectId!, $fileUrls: [String!]!) {
  updateCourseAttendeeFiles(id: $id, fileUrls: $fileUrls) {
    message
    data {
      ...CourseAttendee
    }
  }
}

mutation deleteCourseAttendee($id: ObjectId!) {
  deleteCourseAttendee(id: $id) {
    message
    data {
      ...CourseAttendee
    }
  }
}

mutation changeCourseAttendeeStatus($id: ObjectId!, $status: Status!) {
  changeCourseAttendeeStatus(id: $id, status: $status) {
    message
    data {
      ...CourseAttendee
    }
  }
}

mutation updateAttendanceHours($id: ObjectId!, $hours: Float!) {
  updateAttendanceHours(id: $id, hours: $hours) {
    message
    data {
      hoursAttended
      online
      session {
        course
      }
    }
  }
}

mutation updateAttendanceOnline($id: ObjectId!, $online: Boolean!) {
  updateAttendanceOnline(id: $id, online: $online) {
    message
    data {
      hoursAttended
      online
      session {
        course
      }
    }
  }
}
